<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaMask Connection Example</title>
    <script src="https://cdn.jsdelivr.net/npm/ethereumjs-util@7.1.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.5.1/dist/ethers.min.js"></script>
</head>

<body>

    <h1>MetaMask Connection Example</h1>

    <button id="connectButton">Connect to MetaMask</button>
    <br><br>

    <label for="addressInput">Enter Ethereum Address:</label>
    <input type="text" id="addressInput" value="0xYourAddressHere">
    <button id="fetchDataButton">Fetch Ether Balance</button>
    <br><br>

    <h3>Ether Balance:</h3>
    <div id="balanceDisplay">-</div>

    <script>
        let provider;

        async function initialize() {
            if (typeof ethereum !== 'undefined') {
                ethereum.on('chainChanged', () => document.location.reload());
                ethereum.on('accountsChanged', () => document.location.reload());
            }
        }

        async function connectMetaMask() {
            if (typeof ethereum !== 'undefined') {
                try {
                    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.providers.Web3Provider(ethereum);
                    console.log("Connected to:", accounts[0]);
                } catch (err) {
                    console.error("User rejected the connection:", err);
                }
            } else {
                alert("MetaMask is not installed!");
            }
        }

        async function fetchBalance() {
            const address = document.getElementById("addressInput").value;
            if (!ethers.utils.isAddress(address)) {
                alert("Invalid Ethereum address.");
                return;
            }

            const balance = await provider.getBalance(address);
            document.getElementById("balanceDisplay").innerText = ethers.utils.formatEther(balance) + " ETH";
        }

        document.getElementById("connectButton").addEventListener("click", connectMetaMask);
        document.getElementById("fetchDataButton").addEventListener("click", fetchBalance);

        window.onload = initialize;
    </script>

</body>

</html>
