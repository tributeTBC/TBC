class EthereumApp {
  constructor() {
    this.web3 = null;
    this.contract = null;
    this.abi = [
      /* your ABI here */
    ];
    this.contractAddress = "0x6227F8e5D2d94De5310d6d46Fb698C4C6ADd143D"; // Replace with your contract's address
  }

  async loadWeb3() {
    if (window.ethereum) {
      window.web3 = new Web3(window.ethereum);
      await window.ethereum.enable();
      this.web3 = window.web3;
    } else if (window.web3) {
      window.web3 = new Web3(window.web3.currentProvider);
      this.web3 = window.web3;
    } else {
      alert("Non-Ethereum browser detected. Consider trying MetaMask!");
      return;
    }
  }

  async connectToEthereum() {
    await this.loadWeb3();
    this.contract = new this.web3.eth.Contract(this.abi, this.contractAddress);
    await this.displayFunctionsAndResults();
  }

  async displayFunctionsAndResults() {
    try {
      const methodsToCall = [
        "PROPOSAL_DURATION",
        "developer",
        "lockedTokens",
        "proposalActive",
        "proposalAmount",
        "proposalExpiry",
        "token",
        "tokensRequiredToFinalize",
        "votesAgainst",
        "votesInFavor",
      ];

      for (let method of methodsToCall) {
        let result = await this.contract.methods[method]().call();
        console.log(method, result);
      }

      const isActive = await this.contract.methods.proposalActive().call();
      if (isActive) {
        document.getElementById("explainerText").textContent =
          "There is an active proposal. You can vote for or against it using the interface below.";
      } else {
        document.getElementById("explainerText").textContent =
          "There is currently no active proposal.";
      }
    } catch (error) {
      console.error("Error fetching proposal details:", error.message);
      document.getElementById("explainerText").textContent =
        "Error fetching proposal details. Please ensure you're connected to the right network and try again.";
    }
  }

  async disconnect() {
    if (window.ethereum) {
      try {
        await window.ethereum.request({ method: "eth_accounts" });
        console.log("Disconnected");
      } catch (error) {
        console.error("Error disconnecting:", error.message);
      }
    } else {
      alert("Ethereum provider not detected.");
    }
  }
}

const app = new EthereumApp();

document.getElementById("connectButton").addEventListener("click", async () => {
  await app.connectToEthereum();
});

document
  .getElementById("disconnectButton")
  .addEventListener("click", async () => {
    await app.disconnect();
  });
