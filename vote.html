<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposal Voting</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'VT323', monospace;
            font-size: 20px;
            background-color: #000; /* Setting terminal black background */
            color: #f3f3f3;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: auto;
        }

        #output a {
            color: #00BFFF; /* SkyBlue color for links */
            text-decoration: none; /* Remove the underlines */
            transition: color 0.3s ease; /* Smooth color transition */
        }

        #output a:hover {
            color: #007BFF; /* Darker blue for hover state */
        }

        #connectBtn, #disconnectBtn {
            cursor: pointer;
            padding: 10px 20px;
            background-color: #444;
            border-radius: 4px;
            transition: background-color 0.3s;
            font-size: 1.2em; /* Increased text size */
        }

        #connectBtn:hover, #disconnectBtn:hover {
            background-color: #555;
        }

        .explainer-text {
            margin-top: 20px;
            font-size: 1.2em;
        }

        .bold {
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            #connectBtn, #disconnectBtn {
                padding: 5px 10px;
                font-size: 1em;
            }

            .explainer-text {
                font-size: 1em;
            }
        }
    </style>
</head>

<body>

    <!-- Connect and Disconnect Buttons -->
    <div id="controls">
        <button id="connectBtn">Connect</button>
        <button id="disconnectBtn">Disconnect</button>
    </div>

    <!-- Output for Proposal Data -->
    <div id="output"></div>

    <!-- Explainer Text -->
    <div class="explainer-text">
        <!-- This content will be filled dynamically based on the fetched data -->
    </div>
    <script>
        const ABI = [
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_tokenAddress",
                        "type": "address"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "bool",
                        "name": "approved",
                        "type": "bool"
                    }
                ],
                "name": "ProposalFinalized",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "developer",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "ProposalStarted",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "voter",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "bool",
                        "name": "inFavor",
                        "type": "bool"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "Voted",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "PROPOSAL_DURATION",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "currentTotalSupply",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "developer",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "emergencyReset",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "finalizeProposal",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "lockedTokens",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "proposalActive",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "proposalAmount",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "proposalExpiry",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "startProposal",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "token",
                "outputs": [
                    {
                        "internalType": "contract IToken",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "tokensRequiredToFinalize",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "unlockTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "bool",
                        "name": "_inFavor",
                        "type": "bool"
                    },
                    {
                        "internalType": "uint256",
                        "name": "_amount",
                        "type": "uint256"
                    }
                ],
                "name": "vote",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "votesAgainst",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "votesInFavor",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];
    </script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.3.5/dist/web3.min.js"></script>
    <script>
    let web3;
    let contract;

    // Connect to Ethereum
    document.getElementById("connectBtn").addEventListener("click", async () => {
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.request({ method: 'eth_requestAccounts' });
            web3 = new Web3(window.ethereum);
            const address = "0x6227F8e5D2d94De5310d6d46Fb698C4C6ADd143D"; // Replace with your contract's address
            contract = new web3.eth.Contract(ABI, address);
            fetchData();
        }
    });

    // Disconnect and clear output
    document.getElementById("disconnectBtn").addEventListener("click", () => {
        document.getElementById("output").innerHTML = "";
        document.querySelector(".explainer-text").textContent = "";
    });

    async function fetchData() {
        const isActive = await contract.methods.isActive().call();
        if (isActive) {
            const currentTotalSupply = await contract.methods.currentTotalSupply().call();
            const proposalAmount = await contract.methods.proposalAmount().call();
            const tokensRequiredToFinalize = await contract.methods.tokensRequiredToFinalize().call();
            const proposalActive = await contract.methods.proposalActive().call();
            const votesInFavor = await contract.methods.votesInFavor().call();
            const votesAgainst = await contract.methods.votesAgainst().call();

            // Convert to human-readable format (adjust this if needed)
            const humanReadableSupply = web3.utils.fromWei(currentTotalSupply, 'ether');
            const humanReadableProposal = web3.utils.fromWei(proposalAmount, 'ether');
            const humanReadableTokensRequired = web3.utils.fromWei(tokensRequiredToFinalize, 'ether');

            // Displaying data
            const outputDiv = document.getElementById("output");
            outputDiv.innerHTML = `
                Proposal Active: <span class="bold">${proposalActive}</span><br>
                Votes in Favor: <span class="bold">${votesInFavor}</span><br>
                Votes Against: <span class="bold">${votesAgainst}</span><br>
                Current Total Supply: <span class="bold">${humanReadableSupply}</span><br>
                Proposed Amount to Release: <span class="bold">${humanReadableProposal}</span><br>
                Tokens Required to Finalize: <span class="bold">${humanReadableTokensRequired}</span>
            `;

            // Setting the explainer text
            const explainerDiv = document.querySelector(".explainer-text");
            explainerDiv.innerHTML = `There is a fund release proposal by devs. The current total supply is <span class="bold">${humanReadableSupply}</span>, with a proposed release amount of <span class="bold">${humanReadableProposal}</span>. An additional <span class="bold">${humanReadableTokensRequired}</span> tokens are required in favor for the proposal to pass. You can cast your vote below.`;
        } else {
            document.querySelector(".explainer-text").textContent = "Devs have not proposed any fund release for the time being.";
        }
    }
</script>
</body>

</html>
